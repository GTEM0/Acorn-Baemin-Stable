<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.acorn.HomeMapper">

	<!-- 주소관련 -->
	
	<!-- 등록 -->
	<insert id="insertAddress" parameterType="AddressDTO">
		INSERT INTO address_tbl (userCode, deliveryAddress, detailDeliveryAddress)
		VALUES (#{userCode}, #{deliveryAddress}, #{detailDeliveryAddress})
	</insert>
	
	<!-- 변경 -->
	<update id="updateAddress" parameterType="AddressDTO">
		UPDATE address_tbl
		SET
			deliveryAddress = #{deliveryAddress},
			detailDeleveryAddress = #{detailDeliveryAddress}
		WHERE
			addressCode = #{addressCode}
	</update>
	
	<!-- 조회 -->
	<select id="selectAddress" resultType="AddressDTO" parameterType="int">
		SELECT * FROM address_tbl
		WHERE userCode= #{userCode}
	</select>
	
	<!-- 주소코드 조회 -->
	<select id="selectAddressCode" resultType="int" parameterType="int">
		SELECT addressCode FROM address_tbl
		WHERE userCode= #{userCode}
	</select>
	
	<!-- 삭제 -->
	<delete id="deleteAddress" parameterType="int">
		DELETE
		FROM address_tbl
		WHERE addressCode = #{addressCode}
	</delete>

	<!-- 검색 관련 -->
	<!-- 검색 -->
	<select id="searchStoresAndMenus" resultType="StoreDTO"
		parameterType="String">
		
		SELECT store_tbl.*, GROUP_CONCAT(menu_tbl.menuName) AS menuNames
		FROM store_tbl
		JOIN menu_tbl ON store_tbl.storeCode = menu_tbl.storeCode
		WHERE REPLACE(LOWER(store_tbl.storeName), ' ', '') LIKE CONCAT('%',
		REPLACE(LOWER(#{searchTerm}), ' ', ''), '%')
		OR REPLACE(LOWER(menu_tbl.menuName), ' ', '') LIKE CONCAT('%',
		REPLACE(LOWER(#{searchTerm}), ' ', ''), '%')
		GROUP BY store_tbl.storeCode, store_tbl.storeName, store_tbl.storeStatus
		ORDER BY store_tbl.storeStatus

	</select>

	<!-- 찜관련 -->
	
	<!-- 찜 조회 -->
	<select id="zzimSelectAll" resultType="ZzimStoreDTO"
		parameterType="int">
		SELECT z.*, s.*
		FROM zzim_tbl z
		JOIN store_tbl s ON z.storeCode = s.storeCode
		WHERE userCode = #{userCode}
		ORDER BY s.storeStatus ASC
	</select>


	<!-- 찜 삭제 -->
	<delete id="zzimDelete" parameterType="int">
		Delete
		From zzim_tbl
		WHERE
		userCode = #{userCode} AND storeCode = #{storeCode}
	</delete>

	<!-- 찜 추가 -->
	<insert id="zzimInsert" parameterType="ZzimDTO">
		INSERT INTO zzim_tbl (userCode, storeCode) VALUES 
		(#{userCode}, #{storeCode})
	</insert>
	
	<!-- 찜 유무 -->
	<select id="zzimCheck" resultType="int"
		parameterType="ZzimDTO">
		SELECT COUNT(*) FROM zzim_tbl
		WHERE userCode = #{userCode} and storeCode = #{storeCode}
	</select>
	
	
	<!-- 주문내역 관련 -->
	
	<!-- 주문내역 조회 -->
	<select id="orderSelectAll" resultType="OrderDTO"
		parameterType="int">
		SELECT *
		FROM order_tbl
		WHERE userCode = #{userCode}
		ORDER
		BY orderDate DESC, orderNumber DESC
	</select>

	<!-- 주문내역 삭제 -->
	<delete id="orderDelete" parameterType="int">
		Delete
		FROM order_tbl
		WHERE orderNumber = #{orderNumber}
	</delete>



	<!-- 주문 상세내역 관련 -->
	<!-- 주문상세내역 조회 -->
	<select id="orderDetailSelect" resultType="OrderDTO"
		parameterType="int">
		SELECT *
		from order_tbl
		WHERE orderNumber = #{orderNumber}
	</select>

</mapper>